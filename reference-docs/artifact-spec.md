# Output Artifact Specification

The pipeline produces artifacts on both success and failure. Every run produces *something* — work is never silently lost.

---

## Success Artifact

Produced when all validation gates pass (either on the first cycle or after QA retries).

### 1. Code Artifact

- **Feature branch** with all task branches merged: `spawnee/<ticket>-<description>`
- Clean commit history — each task is a merge commit (or squash commit, configurable)
- No stale task branches left behind

### 2. Pull Request

Created via `gh pr create` with the following structure:

```markdown
## Summary

<1-3 sentence description of what changed and why, derived from the task template description>

## Changes

<Bulleted list of concrete changes, one per beads issue completed>

- [<issue-id>] <issue title>: <one-line description of what was implemented>
- [<issue-id>] <issue title>: <one-line description>

## Validation Results

| Gate | Result | Cycle |
|------|--------|-------|
| typecheck | pass | 1 |
| unit | pass | 1 |
| e2e | fail → pass | 1 → 2 |

**QA Cycles:** 2 of 3 max

## Discovered Work

<Issues filed by agents during execution that are outside the scope of this task>

- [<issue-id>] <title> (type: bug, priority: 2)
- [<issue-id>] <title> (type: task, priority: 3)

## Acceptance Criteria

- [x] <criterion 1>
- [x] <criterion 2>
- [x] <criterion 3>

---

Generated by Agentic Dev Pipeline
Template: <template-id>
Beads epic: <epic-id>
```

### 3. Beads Audit Trail

The full issue lifecycle is preserved in beads and can be exported:

```bash
bd list --status=all          # All issues created during this pipeline run
bd show <epic-id>             # Epic with all child issues and dependencies
```

The audit trail captures:
- When each issue was created, claimed, and closed
- Dependency relationships between issues
- Which issues were created during planning vs. discovered during execution vs. created by QA failures
- QA cycle associations (which cycle generated which issues)

### 4. Test Report

A structured summary of all validation gate results across all QA cycles:

```
Pipeline Run: <template-id>
Status: SUCCESS
QA Cycles: 2 of 3 max

Cycle 1:
  typecheck: PASS (0 errors)
  unit: PASS (47 tests, 0 failures)
  e2e: FAIL (3 specs, 1 failure)
    FAIL: bulk-import.cy.ts > "should display validation errors for invalid rows"
      → Created issue: <issue-id>

Cycle 2:
  typecheck: PASS (0 errors)
  unit: PASS (48 tests, 0 failures)
  e2e: PASS (3 specs, 0 failures)

Total issues created: 8
  Planning: 5
  Discovered: 2
  QA failures: 1 (resolved in cycle 2)
```

---

## Failure Artifact

Produced when `max_qa_cycles` is exhausted without all gates passing.

### 1. Partial Code Artifact

- Feature branch with all completed work merged
- Task branches for incomplete work preserved (not deleted)
- Branch state is documented so a human can resume

### 2. Failure Report

```markdown
## Pipeline Failure Report

**Template:** <template-id>
**Status:** FAILED — QA cycles exhausted (<max_qa_cycles> of <max_qa_cycles>)

### Remaining Failures

| Issue | Gate | Summary | Cycles Attempted |
|-------|------|---------|------------------|
| <id>  | e2e  | Timeout on bulk import with 500+ rows | 3 |
| <id>  | unit | ReportRoute.get() returns wrong shape | 2 |

### What Was Completed

<List of issues that were successfully implemented and validated>

### Failure Analysis

<For each remaining failure: what was tried across QA cycles, what error messages persisted, and any patterns observed>

### Recommended Next Steps

<Actionable suggestions for human review>
- Consider increasing the database query timeout for bulk operations
- The ReportRoute test may need a fixture update after the schema change in cycle 1
```

### 3. Beads State

All issues remain in their current state — nothing is force-closed on failure:
- Completed issues: `closed`
- Failed QA issues: `open` with full QA cycle metadata in descriptions
- Discovered issues: `open` with priority assigned by the agent

A human can resume work by running:
```bash
bd ready          # See what's left
bd blocked        # See what's stuck and why
```

---

## Artifact Storage

| Artifact | Location | Format |
|----------|----------|--------|
| Code | Git feature branch | Git commits |
| Pull request | GitHub | Markdown via `gh pr create` |
| Beads audit trail | `.beads/` directory in pipeline project | Beads database |
| Test report | PR description or pipeline stdout | Structured text |
| Failure report | PR description or pipeline stdout | Markdown |
